<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }

        .user-message {
            background: #667eea;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .ai-message {
            background: #f1f1f1;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .chat-input-container {
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .send-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            align-self: flex-start;
            padding: 12px 16px;
            background: #f1f1f1;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .api-setup {
            padding: 15px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            margin: 10px;
            font-size: 12px;
            color: #856404;
        }

        .api-input {
            width: 100%;
            padding: 8px 12px;
            margin-top: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            🤖 AI Assistant
        </div>
        
        <div class="api-setup">
            <strong>🔑 API Setup:</strong> Your settings are automatically saved!
            <select id="apiProvider" class="api-input" style="margin-bottom: 8px;">
                <option value="demo">Demo Mode (No API needed)</option>
                <option value="gemini">Google Gemini API (Recommended)</option>
                <option value="huggingface">Hugging Face API</option>
                <option value="openai">OpenAI API</option>
            </select>
            <input type="password" class="api-input" id="apiToken" placeholder="Enter API token (automatically saved)..." style="display: none;">
            <div style="font-size: 10px; color: #666; margin-top: 5px;">
                💡 Your API tokens are saved locally in cookies for convenience
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message ai-message">
                👋 Hello! I'm your AI assistant. Choose an API provider above or use Demo Mode to get started!
            </div>
        </div>
        
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="messageInput" placeholder="Type your message..." disabled>
            <button class="send-btn" id="sendBtn" disabled>Send</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const apiTokenInput = document.getElementById('apiToken');
        const apiProvider = document.getElementById('apiProvider');
        
        let apiToken = '';
        let selectedProvider = 'demo';
        
        // Cookie functions
        function setCookie(name, value, days = 30) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Strict`;
        }
        
        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }
        
        function deleteCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`;
        }
        
        // Load saved settings on page load
        function loadSavedSettings() {
            const savedProvider = getCookie('aiChatbot_provider');
            const savedToken = getCookie('aiChatbot_token');
            
            if (savedProvider) {
                apiProvider.value = savedProvider;
                selectedProvider = savedProvider;
            }
            
            if (savedToken && selectedProvider !== 'demo') {
                apiTokenInput.value = savedToken;
                apiToken = savedToken;
            }
            
            updateUIState();
        }
        
        // Update UI based on current settings
        function updateUIState() {
            if (selectedProvider === 'demo') {
                apiTokenInput.style.display = 'none';
                messageInput.disabled = false;
                sendBtn.disabled = false;
                messageInput.placeholder = "Type your message...";
            } else {
                apiTokenInput.style.display = 'block';
                const hasToken = apiToken.length > 0;
                messageInput.disabled = !hasToken;
                sendBtn.disabled = !hasToken;
                messageInput.placeholder = hasToken ? "Type your message..." : "Enter API token first...";
            }
        }
        
        // Handle API provider selection
        apiProvider.addEventListener('change', function() {
            selectedProvider = this.value;
            setCookie('aiChatbot_provider', selectedProvider);
            
            // Clear token display when switching to demo
            if (selectedProvider === 'demo') {
                apiTokenInput.value = '';
                apiToken = '';
            } else {
                // Load saved token for this provider
                const savedToken = getCookie('aiChatbot_token');
                if (savedToken) {
                    apiTokenInput.value = savedToken;
                    apiToken = savedToken;
                }
            }
            
            updateUIState();
        });

        // Save token when entered
        apiTokenInput.addEventListener('input', function() {
            apiToken = this.value.trim();
            
            if (selectedProvider !== 'demo') {
                // Save token to cookie (encrypted would be better in production)
                if (apiToken.length > 10) {
                    setCookie('aiChatbot_token', apiToken);
                } else if (apiToken.length === 0) {
                    deleteCookie('aiChatbot_token');
                }
                
                updateUIState();
            }
        });

        // Send message function
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            if (selectedProvider !== 'demo' && !apiToken) {
                addMessage('Please enter your API token first!', 'ai');
                return;
            }

            // Add user message
            addMessage(message, 'user');
            messageInput.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                let aiResponse = '';
                
                if (selectedProvider === 'demo') {
                    aiResponse = await getDemoResponse(message);
                } else if (selectedProvider === 'gemini') {
                    aiResponse = await getGeminiResponse(message);
                } else if (selectedProvider === 'huggingface') {
                    aiResponse = await getHuggingFaceResponse(message);
                } else if (selectedProvider === 'openai') {
                    aiResponse = await getOpenAIResponse(message);
                }
                
                // Remove typing indicator
                removeTypingIndicator();
                addMessage(aiResponse, 'ai');
                
            } catch (error) {
                removeTypingIndicator();
                addMessage('Sorry, there was an error. Please try again.', 'ai');
                console.error('Error:', error);
            }
        }

        // Enhanced Demo AI responses (works without API)
        async function getDemoResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Simulate thinking time
            await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 1200));
            
            // Smart responses based on keywords and context
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                const greetings = [
                    "Hello! Great to meet you! What's on your mind today?",
                    "Hi there! I'm excited to chat with you. How can I help?",
                    "Hey! Welcome to our conversation. What would you like to talk about?",
                    "Hello! I'm here and ready to help. What's going well for you today?"
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            } 
            
            else if (lowerMessage.includes('how are you') || lowerMessage.includes('how do you feel')) {
                const feelings = [
                    "I'm doing wonderfully, thank you for asking! I'm energized and ready to help. How are you feeling today?",
                    "I'm great! I love having conversations and learning new things. What's been the highlight of your day?",
                    "I'm feeling quite positive and helpful today! Thanks for checking in. How has your day been going?"
                ];
                return feelings[Math.floor(Math.random() * feelings.length)];
            }
            
            else if (lowerMessage.includes('what') && (lowerMessage.includes('name') || lowerMessage.includes('called'))) {
                return "I'm an AI assistant! You can call me whatever feels natural - AI, Assistant, or just chat with me directly. I'm here to help with questions, have conversations, or just be a friendly chat partner. What would you like to know?";
            }
            
            else if (lowerMessage.includes('weather') || lowerMessage.includes('temperature')) {
                return "I don't have access to real-time weather data in demo mode, but I'd recommend checking your local weather app or website! Is there anything else I can help you with instead?";
            }
            
            else if (lowerMessage.includes('time') || lowerMessage.includes('date')) {
                const now = new Date();
                return `The current time is ${now.toLocaleTimeString()} and today is ${now.toLocaleDateString()}. Is there something time-sensitive I can help you with?`;
            }
            
            else if (lowerMessage.includes('joke') || lowerMessage.includes('funny')) {
                const jokes = [
                    "Why don't scientists trust atoms? Because they make up everything! 😄",
                    "Why did the AI go to therapy? It had too many deep learning issues! 🤖",
                    "What do you call a bear with no teeth? A gummy bear! 🐻",
                    "Why don't programmers like nature? It has too many bugs! 🐛",
                    "How do you organize a space party? You planet! 🚀",
                    "Why did the computer go to the doctor? Because it had a virus! 💻"
                ];
                return jokes[Math.floor(Math.random() * jokes.length)];
            }
            
            else if (lowerMessage.includes('help') || lowerMessage.includes('what can you do')) {
                return "I'm here to help with lots of things! I can:\n\n• Answer questions and provide information\n• Have friendly conversations\n• Tell jokes and stories\n• Help with creative writing\n• Discuss various topics\n• Give advice (though I'm just demo mode)\n\nFor even better responses, try switching to Google Gemini API! What interests you most?";
            }
            
            else if (lowerMessage.includes('story') || lowerMessage.includes('tell me about')) {
                const stories = [
                    "Here's something interesting: Did you know that octopuses have three hearts and blue blood? Two hearts pump blood to their gills, while the third pumps blood to the rest of their body!",
                    "Fun fact: Honey never spoils! Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still perfectly edible.",
                    "Amazing nature fact: Trees can 'talk' to each other through underground fungal networks, sharing nutrients and warning each other about dangers!"
                ];
                return stories[Math.floor(Math.random() * stories.length)];
            }
            
            else if (lowerMessage.includes('thank') || lowerMessage.includes('thanks')) {
                return "You're very welcome! I'm happy to help. Is there anything else you'd like to chat about or any other questions I can answer?";
            }
            
            else if (lowerMessage.includes('bye') || lowerMessage.includes('goodbye')) {
                return "Goodbye! It was great chatting with you. Feel free to come back anytime if you want to talk more or try out the Google Gemini API for even better conversations! 👋";
            }
            
            else if (lowerMessage.includes('love') || lowerMessage.includes('like')) {
                return "That's wonderful! It's great when we find things we're passionate about. What specifically do you love about it? I'd love to hear more!";
            }
            
            else if (lowerMessage.includes('problem') || lowerMessage.includes('issue') || lowerMessage.includes('trouble')) {
                return "I'm sorry to hear you're having some trouble. While I'm in demo mode and have limited capabilities, I'm here to listen and help however I can. Can you tell me more about what's going on?";
            }
            
            else if (lowerMessage.includes('learn') || lowerMessage.includes('teach') || lowerMessage.includes('explain')) {
                return "I love helping people learn! While my demo responses are limited, I can share some basic information and have discussions. For more detailed explanations, the Google Gemini API would be much better. What topic interests you?";
            }
            
            else {
                const responses = [
                    "That's really interesting! I'd love to hear more about your thoughts on that.",
                    "I find that fascinating! Can you tell me what got you thinking about this?",
                    "That's a great point! What's your experience been with that?",
                    "Thanks for sharing that with me! I'm curious - what made this come to mind?",
                    "That's thought-provoking! I'd enjoy discussing this further with you.",
                    "Interesting perspective! What other aspects of this topic interest you?",
                    "I appreciate you bringing that up! What would you like to explore about it?"
                ];
                return responses[Math.floor(Math.random() * responses.length)] + "\n\n💡 Tip: For much more detailed and helpful responses, try the Google Gemini API option above!";
            }
        }

        // Google Gemini API
        async function getGeminiResponse(message) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiToken}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: message
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 150
                    }
                })
            });

            const data = await response.json();
            
            if (response.ok && data.candidates && data.candidates[0] && data.candidates[0].content) {
                return data.candidates[0].content.parts[0].text;
            } else if (data.error) {
                throw new Error(`Gemini API Error: ${data.error.message}`);
            } else {
                throw new Error('Unexpected response format from Gemini API');
            }
        }

        // Hugging Face API (using new OpenAI-compatible router)
        async function getHuggingFaceResponse(message) {
            try {
                console.log('Using Hugging Face Router...');
                
                const response = await fetch('https://router.huggingface.co/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "openai/gpt-oss-120b:novita",
                        messages: [
                            {
                                role: "user",
                                content: message
                            }
                        ],
                        max_tokens: 150,
                        temperature: 0.7
                    })
                });

                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (response.ok && data.choices && data.choices[0] && data.choices[0].message) {
                    const aiResponse = data.choices[0].message.content.trim();
                    if (aiResponse && aiResponse.length > 1) {
                        return aiResponse;
                    }
                }
                
                // Handle errors
                if (data.error) {
                    console.log('HF Router error:', data.error);
                    
                    // Try with a different model if the first one fails
                    const fallbackResponse = await fetch('https://router.huggingface.co/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: "openai/gpt-oss-20b:novita",
                            messages: [
                                {
                                    role: "user",
                                    content: message
                                }
                            ],
                            max_tokens: 150,
                            temperature: 0.7
                        })
                    });

                    const fallbackData = await fallbackResponse.json();
                    
                    if (fallbackResponse.ok && fallbackData.choices && fallbackData.choices[0]) {
                        return fallbackData.choices[0].message.content.trim();
                    }
                    
                    // If both models fail, return error message
                    return `🤖 HF Router Error: ${data.error.message || data.error}. Try again in a moment!`;
                }
                
                return "🤖 Got an unexpected response format. Please try again!";
                
            } catch (error) {
                console.error('Hugging Face Router error:', error);
                return "🔌 Connection issue with Hugging Face Router. Please check your internet or try Gemini API.";
            }
        }

        // OpenAI API
        async function getOpenAIResponse(message) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [
                        {role: 'user', content: message}
                    ],
                    max_tokens: 150,
                    temperature: 0.7
                })
            });

            const data = await response.json();
            
            if (response.ok && data.choices && data.choices[0]) {
                return data.choices[0].message.content;
            } else if (data.error) {
                throw new Error(`OpenAI API Error: ${data.error.message}`);
            } else {
                throw new Error('Unexpected response format from OpenAI API');
            }
        }

        // Add message to chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
            messageDiv.textContent = text;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('typing-indicator');
            typingDiv.id = 'typingIndicator';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.classList.add('typing-dot');
                typingDiv.appendChild(dot);
            }
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize demo mode and load saved settings
        loadSavedSettings();
    </script>
</body>
</html>